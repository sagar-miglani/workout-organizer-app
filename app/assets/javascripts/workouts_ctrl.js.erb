(function() {
  "use strict";

  angular.module("app").controller('workoutsCtrl', function($scope, $http){

    $scope.setUpIndex = function(){ 
      $http.get('/api/v1/dailyworkouts.json').then(function(response){
        $scope.workouts = response.data;
      });

      $http.get('/api/v1/exercises.json').then(function(response){
        $scope.exercises = response.data;
        initMap($scope.meetings);
      });

    };

    $scope.createWorkout = function(name, day_of_week, duration){ 
      var params = {
        name: name,
        day_of_week: day_of_week,
        duration: 3,
        user_id: 3,
        date: "1-1-1"
      };
      $http.post('/api/v1/dailyworkouts.json', params).then(function(response){
        console.log(response);        
      });

      };

      $scope.setUpShow = function(){
      var path = window.location.pathname; 
      var slicedPath = path.slice(path.lastIndexOf('/')+1, path.length);
      $http.get('/api/v1/dailyworkouts/'+slicedPath+'.json').then(function(response){
        $scope.workout = response.data;
        $scope.workoutExercises = $scope.workout.exercises;
        initMap([$scope.workout]);
      });


      $http.get('/api/v1/exercises.json').then(function(response){
        $scope.exercises = response.data;
        initMap($scope.exercises);
      });
    };

    $scope.addExercise = function(exercise_id, workout_id)
    {
    	var params = {
    		exercise_id: exercise_id,
    		daily_workout_id: workout_id
    	};
    	$http.post('/api/v1/workoutexercises.json', params).then(function(response){
        console.log(response);        
      });
    }

    window.scope = $scope;

  });
}());